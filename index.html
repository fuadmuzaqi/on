<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Web Kasir 2.4 - Mobile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />

  <style>
    :root {
      --primary: #2563eb;
      --danger: #dc2626;
      --success: #22c55e;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --radius: 12px;
      
      /* Optimal touch size */
      --control-minh: 48px; 
      --app-max: 500px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
    
    body {
      background: #020617;
      color: var(--text);
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent; /* Hapus highlight biru saat klik di mobile */
    }

    /* Scrollbar minimalis */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.2); border-radius: 10px; }

    .app {
      max-width: var(--app-max);
      margin: 0 auto;
      padding: 12px;
      padding-bottom: 100px; /* Ruang untuk bottom bar */
    }

    header {
      position: sticky; top: 0; z-index: 100;
      backdrop-filter: blur(15px);
      background: rgba(15, 23, 42, 0.9);
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      padding: 12px;
      display: flex; align-items: center; justify-content: space-between;
      margin: -12px -12px 12px -12px;
    }

    .brand { display: flex; align-items: center; gap: 10px; }
    .logo-dot {
      width: 24px; height: 24px; border-radius: 50%;
      background: linear-gradient(135deg, #22c55e, #2563eb);
      box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
    }
    .brand-title { font-size: 1rem; font-weight: 800; }
    .header-info { text-align: right; }
    .header-time { font-size: 0.7rem; color: var(--muted); display: block; }
    .header-shop { font-size: 0.8rem; font-weight: 700; color: #60a5fa; }

    /* Tabs scrollable tanpa scrollbar terlihat */
    .tabs {
      display: flex; gap: 8px; overflow-x: auto; 
      padding-bottom: 8px; margin-bottom: 12px;
      scrollbar-width: none; -ms-overflow-style: none;
    }
    .tabs::-webkit-scrollbar { display: none; }

    .tab-btn {
      flex: 0 0 auto; padding: 10px 20px; border-radius: 25px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(30, 41, 59, 0.5); color: var(--muted);
      font-size: 0.85rem; font-weight: 600; cursor: pointer;
    }
    .tab-btn.active {
      background: var(--primary); color: white; border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .card {
      background: rgba(15, 23, 42, 0.6);
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.1);
      padding: 16px; margin-bottom: 16px;
    }

    .field-group { margin-bottom: 12px; }
    label { font-size: 0.75rem; color: var(--muted); margin-bottom: 6px; display: block; }
    
    input, select, textarea {
      width: 100%; height: var(--control-minh);
      padding: 0 12px; border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(2, 6, 23, 0.8); color: white;
      font-size: 1rem; outline: none; transition: 0.2s;
    }
    input:focus { border-color: var(--primary); background: rgba(2, 6, 23, 1); }

    .btn {
      width: 100%; height: var(--control-minh); border-radius: 10px;
      border: none; font-weight: 700; font-size: 0.95rem;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      cursor: pointer; transition: 0.2s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-secondary { background: rgba(51, 65, 85, 0.5); color: var(--text); }
    .btn-danger { background: var(--danger); color: white; }
    .btn-sm { height: 36px; font-size: 0.8rem; padding: 0 12px; width: auto; }

    .table-wrapper {
      overflow-x: auto; margin-top: 10px; border-radius: 8px;
      background: rgba(2, 6, 23, 0.4);
    }
    table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    th { background: rgba(30, 41, 59, 0.8); padding: 12px 8px; text-align: left; color: var(--muted); }
    td { padding: 12px 8px; border-bottom: 1px solid rgba(148, 163, 184, 0.1); }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    /* Bottom Floating Bar */
    .bottom-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      padding: 12px; z-index: 100;
      background: linear-gradient(to top, #020617 80%, transparent);
    }
    .bottom-inner {
      max-width: var(--app-max); margin: 0 auto;
      background: #1e293b; padding: 12px 16px; border-radius: 20px;
      display: flex; align-items: center; gap: 12px;
      box-shadow: 0 -10px 25px rgba(0,0,0,0.5);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    .total-info { flex: 1; }
    .total-label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; }
    .total-amount { font-size: 1.1rem; font-weight: 800; color: #fff; display: block; }

    /* Modals */
    .backdrop {
      position: fixed; inset: 0; background: rgba(2, 6, 23, 0.9);
      display: flex; align-items: center; justify-content: center; z-index: 200; padding: 20px;
    }
    .dialog {
      background: #1e293b; width: 100%; max-width: 400px;
      border-radius: 20px; padding: 20px; border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .tag { padding: 2px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: bold; }
    .tag-success { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
    .tag-danger { background: rgba(239, 68, 68, 0.2); color: #f87171; }

    @media (max-width: 400px) {
      .grid-2 { grid-template-columns: 1fr; }
      .brand-title { font-size: 0.9rem; }
    }

    /* Print hidden */
    .printme { display: none; }
    @media print {
      .no-print { display: none !important; }
      .printme { display: block !important; background: white; color: black; }
    }
  </style>
</head>

<body>

  <div id="loginBackdrop" class="backdrop no-print">
    <div class="dialog">
      <h2 style="margin-bottom: 8px;">Akses Kasir</h2>
      <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 20px;">Silahkan masukkan kode akses Anda.</p>
      <div class="field-group">
        <input type="password" id="accessInput" placeholder="Kode Akses..." />
      </div>
      <button class="btn btn-primary" onclick="checkAccess()">Masuk Sekarang</button>
      <p id="loginError" style="color: var(--danger); font-size: 0.8rem; margin-top: 10px; display: none; text-align: center;">Kode salah!</p>
    </div>
  </div>

  <div class="app no-print" id="app" style="display:none;">
    <header>
      <div class="brand">
        <div class="logo-dot"></div>
        <div>
          <span class="brand-title">Web Kasir</span>
          <span class="header-time" id="datetimeText"></span>
        </div>
      </div>
      <div class="header-info">
        <span class="header-shop" id="shopNameHeader">Loading...</span>
      </div>
    </header>

    <div class="tabs">
      <button class="tab-btn active" id="tabKasir" onclick="showTab('kasir')">üõí Kasir</button>
      <button class="tab-btn" id="tabProduk" onclick="showTab('produk')">üì¶ Produk</button>
      <button class="tab-btn" id="tabLaporan" onclick="showTab('laporan')">üìä Laporan</button>
      <button class="tab-btn" id="tabSetting" onclick="showTab('setting')">‚öôÔ∏è Setting</button>
    </div>

    <main>
      <section id="tabKasirContent">
        <div class="card">
          <div class="field-group">
            <label>Cari Produk</label>
            <input id="searchInput" placeholder="Nama atau SKU..." oninput="renderProductList()" />
          </div>
          <div class="grid-2">
            <div class="field-group">
              <label>Jumlah (Qty)</label>
              <input type="number" id="qtyInput" value="1" inputmode="numeric" />
            </div>
            <div class="field-group">
              <label>Diskon (Rp)</label>
              <input type="number" id="discountInput" value="0" inputmode="numeric" />
            </div>
          </div>
          
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Produk</th>
                  <th>Harga</th>
                  <th style="text-align: center;">Aksi</th>
                </tr>
              </thead>
              <tbody id="productTableBody"></tbody>
            </table>
          </div>
        </div>

        <div class="card" id="cartSection">
          <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
            <h3 style="font-size: 0.9rem;">Daftar Belanja</h3>
            <span id="totalItemText" class="tag tag-success">0 Item</span>
          </div>
          <div id="cartList" style="display: flex; flex-direction: column; gap: 10px;">
            </div>
          
          <div class="grid-2" style="margin-top: 20px;">
            <div class="field-group">
              <label>Uang Tunai</label>
              <input type="number" id="bayarInput" value="0" inputmode="numeric" oninput="updateChange()" style="color: #4ade80; font-weight: bold;" />
            </div>
            <div class="field-group">
              <label>Kembalian</label>
              <input type="text" id="kembaliInput" readonly style="background: transparent; border: none; font-weight: bold;" />
            </div>
          </div>
        </div>
      </section>

      <section id="productSection" style="display:none;">
        <div class="card">
            <h3>Kelola Produk</h3>
            <div class="grid-2" style="margin-top:15px">
                 <button class="btn btn-secondary btn-sm" onclick="resetProductForm()">+ Produk Baru</button>
            </div>
            <div id="productForm" style="margin-top:15px">
                <div class="field-group"><label>Nama</label><input id="pName" /></div>
                <div class="grid-2">
                    <div class="field-group"><label>Harga Beli</label><input type="number" id="pBuy" inputmode="numeric"/></div>
                    <div class="field-group"><label>Harga Jual</label><input type="number" id="pSell" inputmode="numeric"/></div>
                </div>
                <div class="grid-2">
                    <div class="field-group"><label>Stok</label><input type="number" id="pStock" inputmode="numeric"/></div>
                    <div class="field-group"><label>SKU</label><input id="pSku" /></div>
                </div>
                <button class="btn btn-primary" onclick="saveProduct()">Simpan Produk</button>
            </div>
        </div>
      </section>
      
      <section id="reportSection" style="display:none;" class="card">
          <h3>Laporan Penjualan</h3>
          <input type="month" id="reportMonth" style="margin: 15px 0;" />
          <div class="grid-2">
              <div class="card" style="background: rgba(37, 99, 235, 0.1); margin-bottom:0">
                  <small>Omset</small>
                  <div id="reportSalesText" style="font-weight:bold">Rp 0</div>
              </div>
              <div class="card" style="background: rgba(34, 197, 94, 0.1); margin-bottom:0">
                  <small>Laba</small>
                  <div id="reportProfitText" style="font-weight:bold">Rp 0</div>
              </div>
          </div>
      </section>

      <section id="settingSection" style="display:none;" class="card">
          <h3>Pengaturan Toko</h3>
          <div class="field-group"><label>Nama Toko</label><input id="sName" /></div>
          <div class="field-group"><label>Alamat</label><textarea id="sAddress" style="height: 60px;"></textarea></div>
          <button class="btn btn-primary" onclick="saveSettings()">Simpan Perubahan</button>
      </section>

    </main>

    <div class="bottom-bar">
      <div class="bottom-inner">
        <div class="total-info">
          <span class="total-label">Total Bayar</span>
          <span class="total-amount" id="bottomTotalText">Rp 0</span>
        </div>
        <button class="btn btn-primary" style="width: auto; padding: 0 25px;" onclick="finishTransaction()">
          Selesai
        </button>
      </div>
    </div>
  </div>

  <div id="receiptBackdrop" class="backdrop no-print" style="display:none;">
    <div class="dialog">
      <h3>Transaksi Berhasil</h3>
      <div id="receiptPreview" style="background: #fff; color: #000; padding: 15px; font-family: monospace; font-size: 12px; margin: 15px 0; border-radius: 5px; white-space: pre-wrap; max-height: 200px; overflow-y: auto;"></div>
      <div class="grid-2">
        <button class="btn btn-primary" onclick="doPrint()">Cetak</button>
        <button class="btn btn-secondary" onclick="closeReceipt()">Tutup</button>
      </div>
    </div>
  </div>

  <div id="printArea" class="printme"></div>

  <script>
    /* LOGIC JAVASCRIPT 
       (Menggunakan logika Anda dengan penyesuaian render untuk mobile)
    */

    const ACCESS_CODE = "fuadeli";
    let products = JSON.parse(localStorage.getItem("pos_products_v1") || "[]");
    let cart = [];
    let sales = JSON.parse(localStorage.getItem("pos_sales_v1") || "[]");
    let settings = JSON.parse(localStorage.getItem("pos_settings_v1") || '{"name":"Toko Saya"}');

    function checkAccess(){
      const val = document.getElementById("accessInput").value.trim();
      if(val === ACCESS_CODE) {
        document.getElementById("loginBackdrop").style.display = "none";
        document.getElementById("app").style.display = "block";
        initApp();
      } else {
        document.getElementById("loginError").style.display = "block";
      }
    }

    function initApp(){
      document.getElementById("shopNameHeader").textContent = settings.name;
      document.getElementById("sName").value = settings.name;
      document.getElementById("sAddress").value = settings.address || "";
      renderProductList();
      updateDateTime();
      setInterval(updateDateTime, 1000);
    }

    function showTab(tab){
      const sections = ["tabKasirContent", "productSection", "reportSection", "settingSection"];
      const buttons = ["tabKasir", "tabProduk", "tabLaporan", "tabSetting"];
      
      sections.forEach(s => document.getElementById(s).style.display = "none");
      buttons.forEach(b => document.getElementById(b).classList.remove("active"));
      
      if(tab === 'kasir') document.getElementById("tabKasirContent").style.display = "block";
      if(tab === 'produk') {
          document.getElementById("productSection").style.display = "block";
          renderProductAdmin();
      }
      if(tab === 'laporan') {
          document.getElementById("reportSection").style.display = "block";
          refreshReport();
      }
      if(tab === 'setting') document.getElementById("settingSection").style.display = "block";
      
      document.getElementById("tab"+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add("active");
    }

    function renderProductList(){
      const body = document.getElementById("productTableBody");
      const q = document.getElementById("searchInput").value.toLowerCase();
      body.innerHTML = "";
      
      products.filter(p => p.name.toLowerCase().includes(q)).forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>
            <div style="font-weight:bold">${p.name}</div>
            <div style="font-size:0.7rem; color:var(--muted)">Stok: ${p.stock}</div>
          </td>
          <td>${formatRupiah(p.sell)}</td>
          <td style="text-align:center">
            <button class="btn btn-primary btn-sm" onclick="addToCart('${p.id}')">+</button>
          </td>
        `;
        body.appendChild(tr);
      });
    }

    function addToCart(pid){
      const p = products.find(x => x.id === pid);
      const qty = parseInt(document.getElementById("qtyInput").value);
      const disc = parseInt(document.getElementById("discountInput").value);
      
      if(p.stock < qty) return alert("Stok tidak cukup!");
      
      let item = cart.find(x => x.productId === pid);
      if(item) {
        item.qty += qty;
        item.discount += disc;
      } else {
        cart.push({
          id: "c"+Date.now(),
          productId: pid,
          name: p.name,
          price: p.sell,
          buy: p.buy,
          qty: qty,
          discount: disc
        });
      }
      renderCart();
    }

    function renderCart(){
      const container = document.getElementById("cartList");
      container.innerHTML = "";
      let total = 0;
      let totalItem = 0;

      cart.forEach(item => {
        const subtotal = (item.qty * item.price) - item.discount;
        total += subtotal;
        totalItem += item.qty;

        const el = document.createElement("div");
        el.style = "display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;";
        el.innerHTML = `
          <div>
            <div style="font-size:0.85rem; font-weight:bold;">${item.name}</div>
            <div style="font-size:0.75rem; color:var(--muted);">${item.qty} x ${formatRupiah(item.price)} - Disc ${formatRupiah(item.discount)}</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:0.85rem; font-weight:bold; color:#60a5fa">${formatRupiah(subtotal)}</div>
            <button onclick="removeFromCart('${item.id}')" style="background:none; border:none; color:var(--danger); font-size:0.7rem;">Hapus</button>
          </div>
        `;
        container.appendChild(el);
      });

      document.getElementById("bottomTotalText").textContent = formatRupiah(total);
      document.getElementById("totalItemText").textContent = totalItem + " Item";
      updateChange();
    }

    function removeFromCart(id){
      cart = cart.filter(x => x.id !== id);
      renderCart();
    }

    function updateChange(){
      const total = cart.reduce((a,b) => a + (b.qty * b.price - b.discount), 0);
      const bayar = parseInt(document.getElementById("bayarInput").value) || 0;
      const kembali = bayar - total;
      document.getElementById("kembaliInput").value = kembali >= 0 ? formatRupiah(kembali) : "Kurang " + formatRupiah(Math.abs(kembali));
    }

    function finishTransaction(){
      if(cart.length === 0) return alert("Keranjang kosong!");
      const total = cart.reduce((a,b) => a + (b.qty * b.price - b.discount), 0);
      const profit = cart.reduce((a,b) => a + ((b.price - b.buy) * b.qty - b.discount), 0);
      const bayar = parseInt(document.getElementById("bayarInput").value) || 0;

      if(bayar < total) return alert("Pembayaran kurang!");

      // Simpan Transaksi
      const trx = {
        invoice: "INV-"+Date.now(),
        date: new Date().toISOString(),
        total,
        profit,
        bayar,
        kembali: bayar - total,
        items: [...cart]
      };
      
      sales.push(trx);
      localStorage.setItem("pos_sales_v1", JSON.stringify(sales));

      // Kurangi Stok
      cart.forEach(c => {
        const p = products.find(x => x.id === c.productId);
        if(p) p.stock -= c.qty;
      });
      localStorage.setItem("pos_products_v1", JSON.stringify(products));

      // Tampilkan Struk
      showReceipt(trx);
      
      // Reset
      cart = [];
      document.getElementById("bayarInput").value = 0;
      renderCart();
      renderProductList();
    }

    function showReceipt(trx){
        let txt = `   ${settings.name.toUpperCase()}\n`;
        txt += `   ${settings.address || ''}\n`;
        txt += `--------------------------\n`;
        txt += `No: ${trx.invoice}\n`;
        txt += `Tgl: ${new Date().toLocaleString()}\n`;
        txt += `--------------------------\n`;
        trx.items.forEach(i => {
            txt += `${i.name.padEnd(15)} ${i.qty}x\n`;
            txt += `         ${formatRupiah(i.qty * i.price - i.discount).padStart(15)}\n`;
        });
        txt += `--------------------------\n`;
        txt += `TOTAL:   ${formatRupiah(trx.total).padStart(15)}\n`;
        txt += `BAYAR:   ${formatRupiah(trx.bayar).padStart(15)}\n`;
        txt += `KEMBALI: ${formatRupiah(trx.kembali).padStart(15)}\n`;
        txt += `--------------------------\n`;
        txt += `      Terima Kasih\n`;

        document.getElementById("receiptPreview").textContent = txt;
        document.getElementById("receiptBackdrop").style.display = "flex";
    }

    function closeReceipt() { document.getElementById("receiptBackdrop").style.display = "none"; }
    
    function doPrint() { window.print(); }

    function formatRupiah(n) { return "Rp " + n.toLocaleString("id-ID"); }

    function updateDateTime(){
      const now = new Date();
      document.getElementById("datetimeText").textContent = now.toLocaleDateString("id-ID", {weekday:'short', day:'numeric', month:'short'}) + " " + now.toLocaleTimeString("id-ID", {hour:'2-digit', minute:'2-digit'});
    }

    // Fungsi tambahan untuk Produk
    function saveProduct(){
        const name = document.getElementById("pName").value;
        const buy = parseInt(document.getElementById("pBuy").value);
        const sell = parseInt(document.getElementById("pSell").value);
        const stock = parseInt(document.getElementById("pStock").value);
        const sku = document.getElementById("pSku").value;

        if(!name || !sell) return alert("Isi data produk!");

        products.push({ id: "p"+Date.now(), name, buy, sell, stock, sku });
        localStorage.setItem("pos_products_v1", JSON.stringify(products));
        resetProductForm();
        renderProductList();
        alert("Produk disimpan!");
    }

    function resetProductForm() {
        ["pName","pBuy","pSell","pStock","pSku"].forEach(id => document.getElementById(id).value = "");
    }

    function saveSettings(){
        settings.name = document.getElementById("sName").value;
        settings.address = document.getElementById("sAddress").value;
        localStorage.setItem("pos_settings_v1", JSON.stringify(settings));
        document.getElementById("shopNameHeader").textContent = settings.name;
        alert("Setting disimpan!");
    }

    function refreshReport(){
        const m = document.getElementById("reportMonth").value; // YYYY-MM
        const filtered = sales.filter(s => s.date.startsWith(m));
        const total = filtered.reduce((a,b) => a + b.total, 0);
        const profit = filtered.reduce((a,b) => a + b.profit, 0);
        
        document.getElementById("reportSalesText").textContent = formatRupiah(total);
        document.getElementById("reportProfitText").textContent = formatRupiah(profit);
    }
  </script>
</body>
</html>
